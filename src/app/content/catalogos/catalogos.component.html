<div class="container-fluid p-4">

  <!-- Header -->
  <header class="bg-light border-bottom">
    <div class="container py-4 px-3">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
         <div class="p-2 bg-primary rounded">
						<!-- Icono de archivo (puedes usar Bootstrap Icons o Font Awesome) -->
						<i class="fas fa-book text-white fs-4"></i>
					</div>
          
          <div class="text-left">
            <h1 class="fw-bold text-dark mb-1 px-0 ">
              {{ mode === 'grid' ? 'Catálogos' : ('Catálogo: ' + (selectedCatalog || '')) }}
            </h1>
            <p class="text-muted mb-0">
              {{ mode === 'grid'
                ? 'Elige un catálogo para administrar sus elementos'
                : 'Administrador del catálogos' }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- GRID -->
  <section *ngIf="mode==='grid'" class="container mt-3">
    <div class="row g-3">
      <div class="col-12 col-sm-6 col-lg-4" *ngFor="let c of cards">
        <div class="card h-100 shadow-sm" role="button" (click)="openCatalog(c)">
          <div class="card-body d-flex gap-3 align-items-start">
            <div class="p-3 bg-primary text-white rounded">
              <i class="{{ c.icon }} fs-4"></i>
            </div>
            <div class="flex-grow-1">
              <h5 class="card-title mb-1">{{ c.titulo }}</h5>
              <p class="card-text text-muted mb-2">{{ c.descripcion }}</p>
            </div>
            <div class="text-muted">
              <i class="fa-solid fa-caret-right"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- TABLA -->
  <section *ngIf="mode==='table'" class="container mt-3">

    <div class="d-flex align-items-center justify-content-between my-3">
      <div class="d-flex align-items-center gap-2">
        <a class="text-decoration-none" role="button" (click)="backToGrid()">
          <i class="fas fa-arrow-left me-2"></i> Volver a catálogos
        </a>
      </div>
      <div class="d-flex gap-2">
        <input type="text" placeholder="Buscar..." [(ngModel)]="searchTerm" (input)="applyFilter()"
               class="form-control" style="min-width:260px" />
        <select class="form-select" style="max-width:120px" [(ngModel)]="pageSize" (change)="onPageSizeChange()">
          <option [ngValue]="5">5</option>
          <option [ngValue]="10">10</option>
          <option [ngValue]="20">20</option>
        </select>
        <div (click)="openCrear()" role="button" class="rounded-3 bg-primary text-white px-3 d-flex align-items-center">
          <i class="fas fa-plus-circle me-2"></i>Crear
        </div>
      </div>
    </div>

    <div class="container-fluid mt-2 p-3 bg-gray rounded-3 border-4">
      <div class="col-md-12 right align-items-right">

        <table class="w-100 table-responsive table-border-colapse">
          <!-- THEAD -->
          <thead *ngIf="selectedCatalog==='determinantes'">
            <tr>
              <td style="width: 3%"> <i class="fas fa-hashtag"></i> # </td>
              <td style="width: 12%"> <i class="fas fa-layer-group"></i> Nivel </td>
              <td style="width: 9%"> <i class="fas fa-building"></i> U. Negocio </td>
              <td style="width: 9%"> <i class="fas fa-id-card"></i> U. Administrativa </td>
              <td style="width: 20%"> <i class="fas fa-sitemap"></i> Área </td>
              <td style="width: 10%"> <i class="fas fa-hashtag"></i> Determinante </td>
              <td style="width: 10%"> <i class="fas fa-network-wired"></i> Dependencia </td>
              <td style="width: 10%"> <i class="fas fa-calendar-alt"></i> F. Registro </td>
              <td style="width: 10%"> <i class="fas fa-clock-rotate-left"></i> F. Modificación </td>
              <td style="width: 7%"> <span class="tooltip-wrapper" [attr.data-tooltip]="'Estatus'"><i class="fas fa-spinner"></i> Estatus</span></td>
              <td style="width: 7%"> <i class="fas fa-gear"></i> Opciones</td>
            </tr>
          </thead>

          <thead *ngIf="selectedCatalog==='tema'">
            <tr>
              <td style="width:60px">#</td>
              <td><i class="fas fa-bookmark"></i> Tema</td>
              <td><i class="fas fa-calendar-alt"></i> Fecha registro</td>
              <td><i class="fas fa-clock-rotate-left"></i> Fecha modificación</td>
              <td style="width:8%!important"><span class="tooltip-wrapper" [attr.data-tooltip]="'Estatus'"><i class="fas fa-spinner"></i> Estatus</span></td>
              <td><i class="fas fa-gear"></i> Opciones</td>
            </tr>
          </thead>

          <thead *ngIf="selectedCatalog==='tipoDocumento'">
            <tr>
              <td style="width:60px">#</td>
              <td><i class="fas fa-file-alt"></i> Tipo de Documento</td>
              <td><i class="fas fa-calendar-alt"></i> Fecha registro</td>
              <td><i class="fas fa-clock-rotate-left"></i> Fecha modificación</td>
              <td style="width:8%!important"><span class="tooltip-wrapper" [attr.data-tooltip]="'Estatus'"><i class="fas fa-spinner"></i> Estatus</span></td>
              <td><i class="fas fa-gear"></i> Opciones</td>
            </tr>
          </thead>

          <!-- TBODY -->
          <tbody *ngIf="paginaPersonal.length > 0; else noData">

            <!-- Determinantes -->
            <ng-container *ngIf="selectedCatalog==='determinantes'">
              <tr *ngFor="let d of paginaPersonal">
                <td>{{ d.id }}</td>
                <td>{{ d.nivel }}</td>
                <td>{{ d.unidadDeNegocio }}</td>
                <td>{{ d.unidadAdministrativa }}</td>
                <td>{{ d.area }}</td>
                <td>{{ d.determinante }}</td>
                <td>{{ d.dependencia }}</td>
                <td>{{ d.fechaRegistro | fechaMexico }}</td>
                <td>{{ d.fechaModificacion ? (d.fechaModificacion | fechaMexico:true) : '—' }}</td>
                <td style="width: 5%;" class="text-center">
                  <span class="tooltip-wrapper" [attr.data-tooltip]="d.activo ? 'activo' : 'inactivo'">
                    <i class="fas fa-circle" [ngClass]="d.activo ? 'text-success' : 'text-danger'"></i>
                  </span>
                </td>
                <td class="text-center">
                  <span class="tooltip-wrapper" [attr.data-tooltip]="'Editar registro'">
                    <i class="tool-icon fas fa-eye" (click)="openEditar(d)"></i>
                  </span>
                  <span class="tooltip-wrapper ms-2" [attr.data-tooltip]="'Activar/Desactivar'">
                    <i class="tool-icon fas fa-cog" (click)="openToggle(d)"></i>
                  </span>
                </td>
              </tr>
            </ng-container>

            <!-- Tema -->
            <ng-container *ngIf="selectedCatalog==='tema'">
              <tr *ngFor="let t of paginaPersonal">
                <td>{{ t.idTema }}</td>
                <td>{{ t.tema }}</td>
                <td>{{ t.fechaRegistro | fechaMexico }}</td>
                <td>{{ t.fechaModificacion ? (t.fechaModificacion | fechaMexico:true) : '—' }}</td>
                <td style="width:5%;" class="text-center">
                  <span class="tooltip-wrapper" [attr.data-tooltip]="t.activo ? 'activo' : 'inactivo'">
                    <i class="fas fa-circle" [ngClass]="t.activo ? 'text-success' : 'text-danger'"></i>
                  </span>
                </td>
                <td class="text-center">
                  <span class="tooltip-wrapper" [attr.data-tooltip]="'Editar registro'">
                    <i class="tool-icon fas fa-eye" (click)="openEditar(t)"></i>
                  </span>
                  <span class="tooltip-wrapper ms-2" [attr.data-tooltip]="'Activar/Desactivar'">
                    <i class="tool-icon fas fa-cog" (click)="openToggle(t)"></i>
                  </span>
                </td>
              </tr>
            </ng-container>

            <!-- Tipo de Documento -->
            <ng-container *ngIf="selectedCatalog==='tipoDocumento'">
              <tr *ngFor="let item of paginaPersonal">
                <td>{{ item.idTipoDocumento }}</td>
                <td>{{ item.tipoDocumento }}</td>
                <td>{{ item.fechaRegistro | fechaMexico }}</td>
                <td>{{ item.fechaModificacion ? (item.fechaModificacion | fechaMexico:true) : '—' }}</td>
                <td style="width:5%;" class="text-center">
                  <span class="tooltip-wrapper" [attr.data-tooltip]="item.activo ? 'activo' : 'inactivo'">
                    <i class="fas fa-circle" [ngClass]="item.activo ? 'text-success' : 'text-danger'"></i>
                  </span>
                </td>
                <td class="text-center">
                  <span class="tooltip-wrapper" [attr.data-tooltip]="'Editar registro'">
                    <i class="tool-icon fas fa-eye" (click)="openEditar(item)"></i>
                  </span>
                  <span class="tooltip-wrapper ms-2" [attr.data-tooltip]="'Activar/Desactivar'">
                    <i class="tool-icon fas fa-cog" (click)="openToggle(item)"></i>
                  </span>
                </td>
              </tr>
            </ng-container>

          </tbody>

          <ng-template #noData>
            <tbody>
              <tr>
                <td colspan="11" class="text-center py-4 text-muted">
                  <i class="fas fa-info-circle me-2"></i>
                  No hay registros disponibles.
                </td>
              </tr>
            </tbody>
          </ng-template>

        </table>

        <!-- Resumen -->
        <div class="text-end my-2" *ngIf="filteredPersonal.length > 0">
          Mostrando del
          <strong>{{ currentPage * pageSize + 1 }}</strong>
          al
          <strong>{{ Math.min((currentPage + 1) * pageSize, filteredPersonal.length) }}</strong>
          de <strong>{{ filteredPersonal.length }}</strong> registros
        </div>

        <!-- Paginación -->
        <div class="pagination" *ngIf="filteredPersonal.length > 0">
          <button (click)="prevPage()" [disabled]="currentPage === 0"><i class="fas fa-caret-left"></i></button>

          <ng-container *ngFor="let p of visiblePages">
            <button (click)="goToPage(p)" [class.active]="p === (currentPage + 1)">
              {{ p }}
            </button>
          </ng-container>

          <button (click)="nextPage()" [disabled]="currentPage === totalPages - 1"><i class="fas fa-caret-right"></i></button>
        </div>

      </div>
    </div>
  </section>

  <!--  MODALES  -->

  <!-- Form crear/editar -->
  <ng-template #modalForm>
    <div class="container-fluid p-2">
      <form [formGroup]="form">
        <!-- DETERMINANTES -->
        <ng-container *ngIf="selectedCatalog==='determinantes'; else simpleForm">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label frmlabel">Nivel</label>
              <div class="input-icon-wrapper">
                <i [ngClass]="isValid('nivel') ? 'fas fa-check-circle icon valid-icon' : isInvalid('nivel') ? 'fas fa-times-circle icon invalid-icon' : 'd-none'"></i>
                <input type="text" class="form-control" formControlName="nivel"
                       [class.invalid]="isInvalid('nivel')" [class.valid]="isValid('nivel')">
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label frmlabel">Unidad de negocio</label>
              <div class="input-icon-wrapper">
                <i [ngClass]="isValid('unidadDeNegocio') ? 'fas fa-check-circle icon valid-icon' : isInvalid('unidadDeNegocio') ? 'fas fa-times-circle icon invalid-icon' : 'd-none'"></i>
                <input type="text" class="form-control" formControlName="unidadDeNegocio"
                       [class.invalid]="isInvalid('unidadDeNegocio')" [class.valid]="isValid('unidadDeNegocio')">
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label frmlabel">Unidad administrativa</label>
              <div class="input-icon-wrapper">
                <i [ngClass]="isValid('unidadAdministrativa') ? 'fas fa-check-circle icon valid-icon' : isInvalid('unidadAdministrativa') ? 'fas fa-times-circle icon invalid-icon' : 'd-none'"></i>
                <input type="text" class="form-control" formControlName="unidadAdministrativa"
                       [class.invalid]="isInvalid('unidadAdministrativa')" [class.valid]="isValid('unidadAdministrativa')">
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label frmlabel required">Área</label>
              <div class="input-icon-wrapper">
                <i [ngClass]="isValid('area') ? 'fas fa-check-circle icon valid-icon' : isInvalid('area') ? 'fas fa-times-circle icon invalid-icon' : 'd-none'"></i>
                <input type="text" class="form-control" formControlName="area"
                       [class.invalid]="isInvalid('area')" [class.valid]="isValid('area')">
              </div>
              <p *ngIf="isInvalid('area')" class="invalid-field">Campo obligatorio.</p>
            </div>

            <div class="col-md-6">
              <label class="form-label frmlabel required">Determinante</label>
              <div class="input-icon-wrapper">
                <i [ngClass]="isValid('determinante') ? 'fas fa-check-circle icon valid-icon' : isInvalid('determinante') ? 'fas fa-times-circle icon invalid-icon' : 'd-none'"></i>
                <input type="text" class="form-control" formControlName="determinante"
                       [class.invalid]="isInvalid('determinante')" [class.valid]="isValid('determinante')">
              </div>
              <p *ngIf="isInvalid('determinante')" class="invalid-field">Campo obligatorio.</p>
            </div>

            <div class="col-md-6">
              <label class="form-label frmlabel">Dependencia</label>
              <div class="input-icon-wrapper">
                <i [ngClass]="isValid('dependencia') ? 'fas fa-check-circle icon valid-icon' : isInvalid('dependencia') ? 'fas fa-times-circle icon invalid-icon' : 'd-none'"></i>
                <input type="text" class="form-control" formControlName="dependencia"
                       [class.invalid]="isInvalid('dependencia')" [class.valid]="isValid('dependencia')">
              </div>
            </div>
          </div>
        </ng-container>

        <!-- TEMA / TIPO DOCUMENTO -->
        <ng-template #simpleForm>
          <div class="row">
            <div class="col-md-6">
              <label class="form-label frmlabel required">Nombre</label>
              <div class="input-icon-wrapper">
                <i [ngClass]="isValid('nombre') ? 'fas fa-check-circle icon valid-icon' : isInvalid('nombre') ? 'fas fa-times-circle icon invalid-icon' : 'd-none'"></i>
                <input type="text" class="form-control" formControlName="nombre"
                       [class.invalid]="isInvalid('nombre')" [class.valid]="isValid('nombre')">
              </div>
              <p *ngIf="isInvalid('nombre')" class="invalid-field">Campo obligatorio.</p>
            </div>
          </div>
        </ng-template>
      </form>
      <p class="text-auxiliary text-muted pt-3">* Campos obligatorios</p>
    </div>
  </ng-template>

  <!-- Activar/Desactivar -->
  <ng-template #activarDesactivarModal>
    <div class="p-3">
      <ng-container *ngIf="registroSeleccionado.activo == 0; else elseTemplate">
        <div class="alert alert-warning m-auto" role="alert">
          <strong>Advertencia:</strong> Esta acción <strong>activará</strong> el registro seleccionado, asegúrese de que es lo que realmente quiere hacer.
        </div>
      </ng-container>
      <ng-template #elseTemplate>
        <div class="alert alert-warning m-auto" role="alert">
          <strong>Advertencia:</strong> Esta acción <strong>desactivará</strong> el registro seleccionado, asegúrese de que es lo que realmente quiere hacer.
        </div>
      </ng-template>
    </div>
  </ng-template>

  <!-- Mensaje de exito -->
  <div class="alert alert-success" *ngIf="updateSuccess">
    <i class="fas fa-check-circle me-2"></i>
    {{ updateMessage }}
  </div>

</div>
